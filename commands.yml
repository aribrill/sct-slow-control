# Low level commands
fan:open_connection: {device: fan, command: open_connection}
fan:close_connection: {device: fan, command: close_connection}
fan:turn_on: {device: fan, command: turn_on}
fan:turn_off: {device: fan, command: turn_off}
fan:read_voltage: {device: fan, command: read_voltage}
fan:read_current: {device: fan, command: read_current}
power:turn_on_main_switch: {device: power, command: turn_on_main_switch}
power:turn_off_main_switch: {device: power, command: turn_off_main_switch}
power:start_supply: {device: power, command: start_supply}
power:stop_supply: {device: power, command: stop_supply}
power:start_HV: {device: power, command: start_HV}
power:stop_HV: {device: power, command: stop_HV}
power:read_supply_current: {device: power, command: read_supply_current}
power:read_supply_measured_voltage:
    device: power
    command: read_supply_measured_voltage
power:read_supply_nominal_voltage:
    device: power
    command: read_supply_nominal_voltage
power:read_HV_current: {device: power, command: read_HV_current}
power:read_HV_measured_voltage:
    device: power
    command: read_HV_measured_voltage
power:read_HV_nominal_voltage:
    device: power
    command: read_HV_nominal_voltage
server:print_message:
    device: server
    command: print_message
    args: [message]
server:sleep:
    device: server
    command: sleep
    args: [secs]
server:set_alert:
    device: server
    command: set_alert
    args: [device, variable, lower_limit, upper_limit]
server:set_repeating_command:
    device: server
    command: set_repeating_command
    # Command args are appended to the args
    args: [interval, command]

# High level commands (composed of multiple low level commands)

monitor_fan:
    args: []
    device_commands:
        -
            device: server
            command: set_alert
            args: [device, variable, lower_limit, upper_limit]
            values: 
                device: fan
                variable: voltage
                lower_limit: 23 #V
                upper_limit: 25 #V
        -
            device: server
            command: set_alert
            args: [device, variable, lower_limit, upper_limit]
            values: 
                device: fan
                variable: current
                lower_limit: 14 #A
                upper_limit: 16 #A
        -
            device: server
            command: set_repeating_command
            args: [command, interval]
            values: {command: 'fan:read_voltage', interval: 30}
        -
            device: server
            command: set_repeating_command
            args: [command, interval]
            values: {command: 'fan:read_current', interval: 30}

start_fans:
    args: []
    device_commands:
        -
            device: fan
            command: turn_on
        -
            device: server
            command: sleep
            args: [secs]
            values: {secs: 3}
        -
            device: fan
            command: read_current
        -
            device: fan
            command: read_voltage

stop_fans:
    args: []
    device_commands:
        -
            device: fan
            device: turn_off
        -
            device: server
            command: sleep
            args: [secs]
            values: {secs: 3}
        -
            device: fan
            command: read_current
        -
            device: fan
            command: read_voltage

power_on:
    args: []
    device_commands:
        -
            device: power
            command: start_main_switch
        -
            device: power
            command: start_70V
        -
            device: power
            command: read_70V_voltage
        -
            device: power
            command: read_70V_current

power_off:
    args: []
    device_commands:
        -
            device: power
            command: stop_70V
        -
            device: power
            command: stop_main_switch
        -
            device: power
            command: read_70V_voltage
        -
            device: power
            command: read_70V_current

test_server:
    args: []
    device_commands:
        -
            device: server
            command: print_message
            args: [message]
            values: {message: "Testing the slow control server."}
        -
            device: server
            command: print_message
            args: [message]
            values: {message: "It's working!"}
        -
            device: server
            command: set_repeating_command
            args: [interval, command]
            values:
                interval: 2
                command: 'server:print_message'
                message: 'Hello, world!'
